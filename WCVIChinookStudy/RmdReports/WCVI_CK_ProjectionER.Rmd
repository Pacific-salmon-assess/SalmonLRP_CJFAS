---
title: "Sensitivity of Projection-based LRPs to ERs"
author: "Carrie Holt"
date: "10/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = normalizePath(".."))  




library(tidyverse)
library(ggplot2)
library(viridis)
library(corrplot)
```

## Sensitivity of Projection-based LRPs to ERs

<!-- See catarina's comments at the bottom -->
The sensitivity of projection-based LRPs to exploitation rates is due to variability in productivity and to a lesser extent capacity (spawners at replacement) among inlets. In a sensitivity analysis where productivity and capacity were drawn from the same distribution for each of the 5 inlets (i.e., each inlet was a replicate of each other), we found that the productivity and capacity tended to be lower for random trials and inlets that dropped below the lower benchmark in at least one year. Random trials and inlets with abundances that remained above the lower benchmark over the time-series tended to be more productive and slightly larger (Fig. \@ref(fig:chinook-SRHistEven)). 
```{r chinook-SRHistEven, fig.cap="Distribution of (a) productivity (log alpha) and (b) spawners at replacement, SREP among MC trials, coloured by whether abundances in that trial remained above the lower benchmark or not, under a 45\\% exploitation. The distribution of productivity and capacity were assumed equal among inlets. ", fig.align="center"}

#knitr::include_graphics("Figures/evenhCor-SRHist.png")
knitr::include_graphics("C:/github/SalmonLRP_RetroEval/WCVIChinookStudy/Figures/evenhCor-SRHist.png")

```

Trials and inlets with low productivity tended to have relatively high Sgen (lower benchmark) values, and a higher frequency of dropping below the lower benchmark. THis variability in productivity among inlets was associated with projection-based LRPs that were sensitive to exploitation rates (Fig. \@ref(fig: chinook-ProjLRPS_Even)).

```{r  chinook-ProjLRPS_Even, fig.cap="Probability of all inlets being above their lower benchmark along a gradient in aggregate abundances within bins of 200 fish, derived from projections over 30 years and 10,000 MC Trials, under a range of average exploitation rates from 5-45\\%, assuming the same distribution of productivity and SREP for each inlets but each trial has its own random draw.", fig.align="center"}

# knitr::include_graphics("Figures/ProjectedLRPs/ERsEven_hCor-ProjLRPCurve-ALLp.png")
knitr::include_graphics("C:/github/SalmonLRP_RetroEval/WCVIChinookStudy/Figures/ProjectedLRPs/ERsEven_hCor-ProjLRPCurve-ALLp.png")

```
When productivity was fixed at the mean value among random trials and inlets, the distribution of spawner-recruitment parameters were the same or similar for trials where abundances dropped below the lower benchmark or remained above it, and the LRP was insensitive to exploitation rate (Fig. \@ref(fig: chinook-ProjLRPS_SameProd) and \@ref(fig: chinook-SRHistSameProd)).

```{r chinook-SRHistSameProd, fig.cap="Distribution of (a) productivity (log alpha) and (b) spawners at replacement, SREP among MC trials, coloured by whether abundances in that trial remained above the lower benchmark or not, under a 45\\% exploitation and constant productivity among trials. The distribution of productivity and capacity were assumed equal among inlets, but each trial has a separate random draw. ", fig.align="center"}
knitr::include_graphics("C:/github/SalmonLRP_RetroEval/WCVIChinookStudy/Figures/sameProdhCor_SRHist.png")

```

```{r  chinook-ProjLRPS_SameProd, fig.cap="Probability of all inlets being above their lower benchmark along a gradient in aggregate abundances within bins of 200 fish, derived from projections over 30 years and 10,000 MC Trials, under a range of average exploitation rates from 5-45\\%, assuming the same disribution of productiivty and SREP for each inlets, but each trial has a separate random draw.", fig.align="center"}

# knitr::include_graphics("Figures/ProjectedLRPs/ERsSameProd_hCor-ProjLRPCurve-ALLp.png")
knitr::include_graphics("C:/github/SalmonLRP_RetroEval/WCVIChinookStudy/Figures/ProjectedLRPs/ERsSameProd_hCor-ProjLRPCurve-ALLp.png")

```

When SREP was fixed at the mean value among random trials, productivities were higher for inlets and trials that remained above the benchmarks though the overlap with the inlets and trails was slightly greater than when both productivity and SREP varied among inlets and trials. The LRP varied with exploitation rates but to a less extent than when both productivity and SREP varied (Fig. \@ref(fig: chinook-ProjLRPS_SameSREP) and \@ref(fig: chinook-SRHistSameSREP)).


```{r chinook-SRHistSameSREP, fig.cap="Distribution of (a) productivity (log alpha) and (b) spawners at replacement, SREP among MC trials, coloured by whether abundances in that trial remained above the lower benchmark or not, under a 45\\% exploitation. The distribution of productivity and capacity were assumed equal among inlets. ", fig.align="center"}
# knitr::include_graphics("Figures/sameSREPhCor_SRHist.png")
knitr::include_graphics("C:/github/SalmonLRP_RetroEval/WCVIChinookStudy/Figures/sameSREPhCor_SRHist.png")

```


```{r  chinook-ProjLRPS_SameSREP, fig.cap="Probability of all inlets being above their lower benchmark along a gradient in aggregate abundances within bins of 200 fish, derived from projections over 30 years and 10,000 MC Trials, under a range of average exploitation rates from 5-45\\%, assuming the same disribution of productiivty and SREP for each inlets, but each trial has a separate random draw.", fig.align="center"}

# knitr::include_graphics("Figures/ProjectedLRPs/ERsSameSREP_hCor-ProjLRPCurve-ALLp.png")
knitr::include_graphics("C:/github/SalmonLRP_RetroEval/WCVIChinookStudy/Figures/ProjectedLRPs/ERsSameSREP_hCor-ProjLRPCurve-ALLp.png")
```

Variability in productivity among inlets results in inlet-specific variability in sensitivity to exploitation rates. Inlets with relatively low productivity fall below lower benchmarks more frequently, resulting in divergences in status among inlets and a higher aggregate abundances required for all inlets to be above their lower benchmarks (higher LRP).

<!-- comments from CAtarina
Here are a few suggestions for the appendix on the sensitivity analysis for the projection absed LRP. 
These might be things that you were already planning to do, but I thought it might be helpful to list them out. capacity

Question: why did you choose to fix SRep and not b or Smax? I'm just wondering if the effect we see from letting SREP vary is from b or from the fact that Srep also depends on a. Or did you calculate sep based on mean alpha, letting only b vary?
I think it might be more useful to show the results for Smax, if that doesn't require ou to run everything again.


1. It wouuld be good to have an introduction section to this appendix listing why we thought this sensitivity analysis was necessary (sensitivity to exploitation rate observed in the base case was not intuitive). and Also listing the sensitivity scenarios we are about to see (if I understood it correctly):

We tested the aggregate projection-based LRP method under three alternative scenarios:

1. All inlets were assumed to have stock-recruitment parameters drawn from the same posterior distributions but a unique set of stock-recruitment parameters was drawn for each trial (i.e. each inlet was a replicate of each other in each trial).

2. The productivity parameter for all inlets was fixed at the mean value of the posterior distribution across inlets and across trials. The capacity parameter was drawn from the posterior distribution and allowed to vary across trials, but not between inlets. 

2. The capaity parameter for all inlets was fixed at the mean value of the posterior distribution across inlets and across trials. The productivity parameter was drawn from the posterior distribution and allowed to vary across trials, but not between inlets. 



Graphs:

histogram:
add to the caption what each colour represent, it is reduntant with the figure legend but I think it helps. 

probability graphs:
The LRP labels need to be bigger. maybe include only the 50% one and make the font larger and bold. ALso what are the orange and green lines again? And What about the horizontal dashed lines? Maybe we just need to include the 50% one?

-->
