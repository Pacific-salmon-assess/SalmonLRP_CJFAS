# Inside South Coast Chum Case Study

Primary contacts: Luke Warkentin (Luke.Warkentin@dfo-mpo.gc.ca), Kendra Holt (Kendra.Holt@dfo-mpo.gc.ca)

## Overview

> The SCChumStudy folder contains the files that are specific to the Limit Reference Point retrospective analysis for the Inside South Coast Chum (non-Fraser) Stock Management Unit. This includes raw input data, code to prepare data and run analyses, case study-specific functions, and outputs (data and figures). 

```r
echo=FALSE

library(sf)
library(ggplot2)
library(leaflet)
library(PNWColors)

# Download chum CU data shapefile from:
# https://open.canada.ca/data/en/dataset/f86c0867-d38d-4072-bd08-57cbbcbafa46
chum_cu <- st_read("DataIn/chum_CU_boundary_shapefile/Chum Salmon CU Boundary_En.shp")
# get south coast chum CUs 
sc_cus <- c("Southern Coastal Streams", "Northeast Vancouver Island", "Upper Knight", "Loughborough", "Bute Inlet", "Georgia Strait", "Howe Sound-Burrard Inlet")
# Get just the 5 CUs without CU-level infilling
sc_cus_no_CU_infilled <- c("Southern Coastal Streams", "Northeast Vancouver Island", "Loughborough","Georgia Strait", "Howe Sound-Burrard Inlet")
#scc <- chum_cu[chum_cu$CU_name %in% sc_cus_no_CU_infilled, ] # get sf object of just south coast chum CUs 
scc <- chum_cu[chum_cu$CU_name %in% sc_cus, ] # get sf object of just south coast chum CUs 

# Get palette
pal <- pnw_palette("Cascades", length(scc$CU_name), type="continuous")

m <- leaflet(scc) %>%
  addTiles() %>%
  #addWMSTiles(baseUrl = "https://services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}.png",
  #            layers = "1", options = WMSTileOptions(format = "image/png", transparent = TRUE)) %>%
  addPolygons(color= pal, fillColor=pal)
m
  
```

## Contents

### DataIn  
_(input data - read only)_  
Pieter Van Will (Pieter.VanWill@dfo-mpo.gc.ca) supplied data

* AgeComp_2018.csv  
Age composition data from Johnstone Strait fishery aggregate

* Chum Escapement Data With Areas_2018.xlsx  
Raw escapement data (spawner counts) with updated 2018 tab

* Chum Escapement Data With Areas_2018.csv  
Raw escapement data (spawner counts), saved from Chum Escapement Data With Areas_2018.xlsx file, _Updated 2018_ sheet  
Visual counts, some Area Under the Curve, some fences

* WildReturnsPVW_2013.csv **NEED TO UPDATE TO 2018**  
Wild returns generated by Pieter Van Will elsewhere, using infilled escapement, harvest, and percent hatchery data from infilling wild escapement data.

* chum_CU_boundary_shapefile  
Shapefile of Conservation Units for Chum, from https://open.canada.ca/data/en/dataset/f86c0867-d38d-4072-bd08-57cbbcbafa46

### DataOut

* SRdatWild.csv  
Time series of spawners and recruits, made by prepare_data.R

* WildEscape_w.Infill_ByCU.csv  

* summary_n_infilled_by_year.csv

* AnnualRetrospective  
Folder containing output data .csv files from LRP retrospective analysis

### Figures  
Folder containing output figures

### runSouthCoastChum.R
Master script to run LRP Retrospective Analyses.  
Set working directory to SalmonLRP_RetroEval/SCChumStudy folder to run (or make an .Rproj file in this folder).

### prepare_data.R
Prepares data for retrospective analysis, including infilling of raw escapement data and creation of stock-recruit brood table. 

### chumDataFunctions.r
Functions specifically for chum case study, including infilling

### infilling_for_reconstruction.R
This code takes the raw escapement data and infills by stream and CU. The outputs of this code were sent to Pieter Van Will to do the run reconstruction, which uses percent wild spawners, and catch to give wild returns (WildReturnsPVW_2013 **NEED TO UPDATE TO 2018**). Does not need to be run to do LRP retrospective analysis.

### make_map.R
Make a map of the Conservation Unit areas.

### SRdata.csv ???? 



